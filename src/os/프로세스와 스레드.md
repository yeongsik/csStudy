# 프로세스와 스레드

# 프로세스

- 프로그램이 진행 중인 상태
- 프로세스는 각각 별도의 주소 공간을 갖고 있다.

## 프로그램이 프로세스가 되는 과정

하드디스크에 있는 프로그램을 실행 시 OS에서 해당 프로그램을 위한 자원들을 할당해준다.

⇒ 즉 프로세스의 초기상태를 설정해준다.

### 할당된 프로세스의 메모리 주소 공간 구성

1. Code : 실행 명령을 포함하는 코드들
2. Data : 전역 변수 ,정적 변수 , 배열 등 글로벌하게 사용하는 데이터
3. Heap : **동적 메모리 영역**
4. Stack : 지역 변수 , 매개 변수 , 리턴 값 등을 사용하는 **임시 메모리 영역**

### PCB(Process Control Block) 블럭 생성

PCB : 프로세스에 대한 정보를 저장하는 운영체제 커널의 자료구조

- PCB는 운영 체제 입장에서 프로세스를 표현한 것
- 각 프로세스 마다 할당

## 멀티 프로세스

- 하나의 프로그램을 여러개의 프로세스로 구성하여 각 프로세스가 병렬적으로 작업을 수행
- 장점
    - 안전성 (메모리 침범 문제를 OS차원에서 해결)
- 단점
    - 각각 독립된 메모리영역을 갖고 있어, 작업량이 많을수록 오버헤드 발생
    - 컨텍스트 스위칭으로 인한 성능 저하

### 컨텍스트 스위칭

프로세스의 상태 정보를 저장, 복원하는 과정 (작업 중인 프로세스의 전환)

동작 중인 프로세스 → 대기 (해당 프로세스 상태 보관)

대기중인 프로세스 → 실행(이전에 보관했던 프로세스면 상태를 복구)

# 스레드

- 프로세스 안에서 실행되는 실제 작업 단위
- 모든 프로세스는 최소한 하나 이상의 스레드를 갖고 있다.
- 프로세스의 자원 영역을 각 스레드들은 공유한다. ( Code, Data, Heap )
- 스택 영역은 스레드마다 하나씩 할당된다.
- 프로세스와 스레드의 관계 : 공장과 일꾼 관계

> 하나의 새로운 프로세스를 생성하는 것보다, 하나의 새로운 쓰레드를 생성하는 것이 더 적은 비용이 든다.
> 

여러 작업을 처리함에 있어서 프로세스를 늘릴 것이냐, 스레드를 늘릴 것이냐 ( 멀티 프로세스 , 멀티 스레드 )에 대한 고민이 발생하는데, 장단점을 생각에 상황에 맞는 방법을 찾는 것이 중요한 것 같다. 

## 공장과 일꾼으로 멀티프로세스 , 멀티 스레드 차이점 비교

- 공장의 일꾼을 더 뽑는게 , 새로운 공장을 짓는 것 보다 더 적은 비용이 든다. ( 멀티 스레드의 적은 비용 )
- 공장 안에 있는 자원은 일꾼들끼리 공유가 되지만 다른 공장에까지 공유하려면 교류가 필요하다 → IPC 통신
- 공장을 여러 개 두개 되면 한 공장을 불타더라도 영향을 받지 않는다. → 멀티 프로세스의 장점인 안정성

## 멀티 스레드의 장단점

- 장점
    - 시스템 자원을 효율적으로 사용 ( 공유된 자원 )
    - 사용자에 대한 응답성 향상
    - 작업이 분리되어 코드가 간결

- 단점 ( 자원을 공유하는데에서 오는 문제들 )
    - 동기화 문제 (일꾼이 공장에 있는 버튼을 동시에 누를 경우)
    - 교착상태가 발생하지 않도록 주의
    - 각 쓰레드가 효율적으로 고르게 실행될 수 있게 해야함

# 프로세스 - 자바 애플리케이션

- 자바 애플리케이션의 경우 JVM (자바 가상머신) 이 프로세스가 생성될 때마다 같이 생성된다.
- 운영체제와 코드 사이에서 JVM이 인터페이스 역할
- 자바에서 실행되는 프로세스 메모리 영역은 일반적인 영역과 조금 다르다.(비슷하지만 다르다)
    
    ⇒ 이름만 다른 느낌
    

### 자바에서 실행되는 프로세스 메모리 영역

- 코드(Code) 영역
    
    ⇒ 자바에서는 코드 영역을 **메소드 영역(Method Area)**
    
    메소드 영역은 클래스 파일의 바이트 코드를 저장하는 곳
    
- 데이터(Data) 영역
    
    ⇒ 자바에서는 데이터 영역을 **스태틱 영역(Static Area)**
    
    스태틱 영역은 **클래스 변수(static variable)**와 **상수(constant)**를 저장하는 곳
    
- 스택(Stack) 영역
    
    ⇒ 자바에서는 스택 영역을 **호출 스택(Call Stack)**
    
    호출 스택은 메서드 호출 시 생성되는 지역 변수(local variable), 매개 변수(parameter) 등을 저장하는 공간
    
- 힙(Heap) 영역
    
    ⇒ 자바에서는 힙 영역을 **동적 메모리 영역(Dynamic Memory Area)**
    
    동적 메모리 영역은 **new 연산자**를 사용하여 생성된 객체와 배열을 저장하는 공간입니다.
    

### 자바 애플리케이션이 프로세스로 생성되는 과정

- 컴파일
- 클래스 로딩
- 인스턴스화
- 초기화
- 메인 메소드 호출
- 실행
- 종료